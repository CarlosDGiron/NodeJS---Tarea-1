<!doctype html>
<html lang="es">

<head>
    <title>Estudiantes</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
</head>

<body>
    <nav
        class="navbar navbar-expand-sm navbar-dark bg-primary"
    >
        <a class="navbar-brand" href="#">Carlos David Girón Leonardo</a>
        <button
            class="navbar-toggler d-lg-none"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapsibleNavId"
            aria-controls="collapsibleNavId"
            aria-expanded="false"
            aria-label="Toggle navigation"
        ></button>
        <div class="collapse navbar-collapse" id="collapsibleNavId">
            <ul class="navbar-nav me-auto mt-2 mt-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" href="#" aria-current="page">Estudiantes <span class="visually-hidden">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Tipos de Sangre</a>
                </li>
                
            </form>
        </div>
    </nav>
    


    <div class="d-flex justify-content-center">
        <h1>Estudiantes</h1><br>    
    </div>
    <div class="d-flex justify-content-end">
        <!-- Modal trigger button -->
        <button type="button" id="btnModal" class="btn btn-primary btn-lg" data-bs-toggle="modal"  data-bs-target="#modalId">
            Agregar Estudiante
        </button>
    </div>

    <div class="table-responsive" style="max-height: 300px ;overflow-y: auto;">
        <table class="table table-striped table-hover table-borderless table-primary align-middle" id="tblStudent">
            <thead class="table-primary">
                <tr>
                    <th>ID</th>
                    <th>Carnet</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Dirección</th>
                    <th>Teléfono</th>
                    <th>Correo Electrónico</th>
                    <th>Tipo de Sangre</th>
                    <th>Fecha de Nacimiento</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                <% const bloodMap=new Map();
                bloodMap.set(1,"O-");
                bloodMap.set(2,"O+");
                bloodMap.set(3,"A-");
                bloodMap.set(4,"A+");
                bloodMap.set(5,"B-");
                bloodMap.set(6,"B+");
                bloodMap.set(7,"AB-");
                bloodMap.set(8,"AB+");
                results.forEach((estudiante)=>{ %>
                    <tr>
                        <td><%= estudiante.id_estudiante %></td>
                        <td><%= estudiante.carnet %></td>
                        <td><%= estudiante.nombres %></td>
                        <td><%= estudiante.apellidos %></td>
                        <td><%= estudiante.direccion %></td>
                        <td><%= estudiante.telefono %></td>
                        <td><%= estudiante.correo_electronico %></td>
                        <td><%= bloodMap.get(estudiante.id_tipo_sangre) %></td>
                        <td><%= estudiante.fecha_nacimiento %></td>
                    </tr>
                    <% }); %>
            </tbody>
            <tfoot>

            </tfoot>
        </table>
    </div>

    
    <!-- Modal Body -->
    <!-- if you want to close by clicking outside the modal, delete the last endpoint:data-bs-backdrop and data-bs-keyboard -->
    <div
        class="modal fade"
        id="modalId"
        tabindex="-1"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        
        role="dialog"
        aria-labelledby="modalTitleId"
        aria-hidden="true"
    >
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitleId">
                        Agregar Estudiante
                    </h5>
                    <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Cancelar"
                    ></button>
                </div>
                <div class="modal-body">
                    <form class="form-control" action="/crud_estudiantes" method="post">
                        <div class="row align-items-center mb-3">
                            <div class="col-1 mb-3">
                                <label for="txtID" class="form-label">ID</label>
                                <input type="text" class="form-control" name="txtID" id="txtID" aria-describedby="helpId"
                                    placeholder="ID" readonly/>
                            </div>
                            <div class="col-1 mb-3">
                                <label for="txtCarnet" class="form-label">Carnet</label>
                                <input type="text" class="form-control" name="txtCarnet" id="txtCarnet" aria-describedby="helpId"
                                    placeholder="E000-E999" pattern="^E\d{3}$" required/>
                            </div>
                            <div class="col-5 mb-3">
                                <label for="txtNombres" class="form-label">Nombres</label>
                                <input type="text" class="form-control" name="txtNombres" id="txtNombres" aria-describedby="helpId"
                                    placeholder="Nombres..." required  />
                            </div>
                            <div class="col-5 mb-3">
                                <label for="txtApellidos" class="form-label">Apellidos</label>
                                <input type="text" class="form-control" name="txtApellidos" id="txtApellidos"
                                    aria-describedby="helpId" placeholder="Apellidos..." required  />
                            </div>
                        </div>
                        <div class="row align-items-center mb-3">
                            <div class="col-12 mb-3">
                                <label for="txtDireccion" class="form-label">Dirección</label>
                                <input type="text" class="form-control" name="txtDireccion" id="txtDireccion"
                                    aria-describedby="helpId" placeholder="Dirección..." required  />
                            </div>
                        </div>
                        <div class="row align-items-center mb-3">
                            <div class="col-3 mb-3">
                                <label for="txtTelefono" class="form-label">Teléfono</label>
                                <input type="number" class="form-control" name="txtTelefono" id="txtTelefono"
                                    aria-describedby="helpId" placeholder="12345678" required  />
                            </div>
                            <div class="col-5 mb-3">
                                <label for="txtCorreoElectronico" class="form-label">Correo Electrónico</label>
                                <input type="text" class="form-control" name="txtCorreoElectronico" id="txtCorreoElectronico"
                                    aria-describedby="helpId" placeholder="correo@dominio.com" required  />
                            </div>
                            <div class="col-2 mb-3">
                                <label for="sltcTipoSangre" class="form-label">Tipo de Sangre</label>
                                <select class="form-select form-select-lg" name="sltcTipoSangre" id="sltcTipoSangre">
                                    <option value="1">O-</option>
                                    <option value="2">O+</option>
                                    <option value="3">A-</option>
                                    <option value="4">A+</option>
                                    <option value="5">B-</option>
                                    <option value="6">B+</option>
                                    <option value="7">AB-</option>
                                    <option value="8">AB+</option>
                                </select>
                            </div>
                            <div class="col-2 mb-3">
                                <label for="txtFechaNacimiento" class="form-label">Fecha de Nacimiento</label>
                                <input type="date" class="form-control" name="txtFechaNacimiento" id="txtFechaNacimiento"
                                    aria-describedby="helpId" placeholder="dd/mm/yyyy" required  />
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            <div class="mx-3 mb-3">
                                <button type="submit" class="btn btn-warning" name="btnLimpiar" id="btnLimpiar">
                                    Limpiar
                                </button>
                            </div>                            
                            <div class="mx-3 mb-3">
                                <button type="submit" class="btn btn-primary" name="btnCrear" id="btnCrear" value="crear">
                                    Crear
                                </button>
                            </div>
                            <div class="mx-3 mb-3">
                                <button type="submit" class="btn btn-success" name="btnModificar" id="btnModificar"
                                    value="modificar">
                                    Modificar
                                </button>
                            </div>
                            <div class="mx-3 mb-3">
                                <button type="submit" class="btn btn-danger" name="btnEliminar" id="btnEliminar" value="eliminar">
                                    Eliminar
                                </button>
                            </div>
                        </div>                
                    </form>
                </div>
                <div class="modal-footer">
                    <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                    >Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Optional: Place to the bottom of scripts -->
    <script>
        const myModal = new bootstrap.Modal(
            document.getElementById("modalId"),
            options,
        );
    </script>
    

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
    <script>
        const studentTable = document.getElementById("tblStudent");
        const id = document.getElementById("txtID");
        const carnet = document.getElementById("txtCarnet");
        const nombres = document.getElementById("txtNombres");
        const apellidos = document.getElementById("txtApellidos");
        const direccion = document.getElementById("txtDireccion");
        const telefono = document.getElementById("txtTelefono");
        const correo_electronico = document.getElementById("txtCorreoElectronico");
        const id_tipo_sangre = document.getElementById("sltcTipoSangre");
        const fecha_nacimiento = document.getElementById("txtFechaNacimiento");
        
        const btnModal= document.getElementById("btnModal");
        const btnLimpiar=document.getElementById("btnLimpiar");

        const today = new Date();

        Array.from(studentTable.querySelectorAll("tbody tr")).forEach(row => {
            row.addEventListener("click", () => {
                const cells = row.getElementsByTagName("td");

                const bloodMap=new Map();
                bloodMap.set("O-",1);
                bloodMap.set("O+",2);
                bloodMap.set("A-",3);
                bloodMap.set("A+",4);
                bloodMap.set("B-",5);
                bloodMap.set("B+",6);
                bloodMap.set("AB-",7);
                bloodMap.set("AB+",8);

                id.value=cells[0].textContent;
                carnet.value=cells[1].textContent;
                nombres.value=cells[2].textContent;
                apellidos.value=cells[3].textContent;
                direccion.value=cells[4].textContent;
                telefono.value=cells[5].textContent;
                correo_electronico.value=cells[6].textContent;
                id_tipo_sangre.value=bloodMap.get(cells[7].textContent);
                dateSplit=cells[8].textContent.split("-");
                fecha_nacimiento.value=`${dateSplit[2]}-${dateSplit[1]}-${dateSplit[0]}`;

                btnModal.click();
            });

            btnLimpiar.addEventListener("click", ()=>{
                id.value="";
                carnet.value="";
                nombres.value="";
                apellidos.value="";
                direccion.value="";
                telefono.value="";
                correo_electronico.value="";
                id_tipo_sangre.value=1;
                fecha_nacimiento.value=`${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
            });
        });

    </script>
</body>

</html>